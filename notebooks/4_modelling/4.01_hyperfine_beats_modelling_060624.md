---
jupytext:
  formats: ipynb,md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.13.6
kernelspec:
  display_name: Python [conda env:epsdev-shared-100122]
  language: python
  name: conda-env-epsdev-shared-100122-py
---

# Hyperfine beat and (electronic) alignment modelling

From prior work and data:

- Forbes, R. et al. (2018) ‘Quantum-beat photoelectron-imaging spectroscopy of Xe in the VUV’, Physical Review A, 97(6), p. 063417. Available at: https://doi.org/10.1103/PhysRevA.97.063417. arXiv: http://arxiv.org/abs/1803.01081, Authorea (original HTML version): https://doi.org/10.22541/au.156045380.07795038
- Data (OSF): https://osf.io/ds8mk/
- [Quantum Metrology with Photoelectrons (Github repo)](https://github.com/phockett/Quantum-Metrology-with-Photoelectrons), particularly the [Alignment 3 notebook](https://github.com/phockett/Quantum-Metrology-with-Photoelectrons/blob/master/Alignment/Alignment-3.ipynb). Functions from this notebook have been incorporated in the current project, under `qbanalysis.hyperfine`.

+++

## Formalism

+++

In many physical processes, multiple eigenstates of the system are populated. This may be the result of thermal effects, in which case the states are incoherent, or via a coherent preparation process. In the latter case, the overall state of the system can be considered as a wavepacket, and will evolve in time. Assuming that the wavepacket is created “instantaneously” (with respect to the timescale of system/wavepacket evolution), such as via photon-absorption from a short laser pulse, then the ensuing dynamics is simply dependent on the phase-evolution of the eigenstates which form the superposition state.

A textbook example is the preparation of a superposition of hyperfine states in rare gas atoms via photo-absorption. Typically, a small number of hyperfine states are prepared, and their evolution results in relatively simple wavepacket behaviour, exhibiting clear quantum beats, correlated with a changing alignment of the charge distribution. A full treatment can be found in Sect. 4.7 of Blum's book [1].

+++

### Hyperfine quantum beats

For the case of quantum beats from a manifold of (hyperfine) states,
the state multipoles can be expressed as a product of an initial
state, and time-dependent coefficients, as per Eqns. 4.131 and 4.134
in Blum [1]:

\begin{equation}
\langle T(J;t)_{KQ}^{\dagger} \rangle =G(J;t)_{K}\langle T(J)_{KQ}^{\dagger}\rangle
\end{equation}

where the time-dependence is given as:

\begin{equation}
G(J;t)_{K}=\frac{1}{2I+1}\sum_{F',F}(2F'+1)(2F+1)\left\{ \begin{array}{ccc}
J & F' & I\\
F & J & K
\end{array}\right\} ^{2}\cos\left[\frac{(E_{F'}-E_{F})t}{\hbar}\right]
\end{equation}

and $\{...\}$ is a $6j$ symbol, $J$ is the electronic angular momentum,
$I$ the nuclear spin and $F,\,F'$ are hyperfine states that comprise the superposition (wavepacket).

Hence, $\langle T(J)_{KQ}^{\dagger}\rangle$ defines the initial state
of the system after preparation of the state $|J,M\rangle$ (defined by the state multipoles, these are discussed in the following section), and the time-evolution of the superposition
is given by $G(J;t)_{K}$. This contains the angular momentum coupling
between the hyperfine states (defined by the $6j$ symbol), and the
relative phase evolution of the states, expressed in terms of their
energy differences.

+++

### State Multipoles
A more physical picture of the geometric properties of an ensemble can be obtained from the _state multipoles_, which are defined by (spherical) tensor operators. These provide a means to expand the irreducible components of the density matrix, and the geometric properties of the ensemble. (See Chapter 4 in Blum [1] for further details.)

In the $\{|JM\rangle\}$ representation (Eqn. 4.8 in Blum [1]):

\begin{equation}
\hat{T}(J',J)_{KQ}=\sum_{M'M}(-1)^{J'-M'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
M' & -M & Q
\end{array}\right)|J'M'\rangle\langle JM|
\end{equation}

Where $\hat{T}(J',J)_{KQ}$ are tensor operators. The corresponding matrix elements are (Eqn. 4.9 in Blum [1]):

\begin{equation}
\langle J'M'|\hat{T}(J',J)_{KQ}|JM\rangle=(-1)^{J'-M'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
M' & -M & Q
\end{array}\right)
\end{equation}

The density matrix can be written in terms of the tensor operators
(Eqn. 4.30 in Blum):

\begin{equation}
\boldsymbol{\rho}=\sum_{KQ}\sum_{J'J}\left[\sum_{M'M}\langle J'M'|\hat{\rho}|JM\rangle(-1)^{J'-M'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
M' & -M & Q
\end{array}\right)\right]\hat{T}(J',J)_{KQ}
\end{equation}

And the state multipoles are defined as the term in square brackets
(Eqn. 4.31 in Blum):

\begin{equation}
\left\langle T(J',J)_{KQ}^{\dagger}\right\rangle =\sum_{M'M}\langle J'M'|\hat{\rho}|JM\rangle(-1)^{J'-M'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
M' & -M & -Q
\end{array}\right)
\end{equation}

And the inverse (Eqn. 4.34 in Blum):

\begin{equation}
\langle J'N'|\hat{\rho}|JN\rangle=\sum_{N'N}(-1)^{J'-N'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
N' & -N & -Q
\end{array}\right)\left\langle T(J',J)_{KQ}^{\dagger}\right\rangle 
\end{equation}

The spatial representation of the ensemble can be defined in terms
of the state multipoles - hence the name - by expanding in a suitable
basis, usually the spherical harmonics. For example, for a single
angular momentum state $J$, this is given by (Eqn. 4.101 in Blum):

\begin{equation}
W(\theta,\phi)=\left(\frac{1}{4\pi}\right)^{1/2}\sum_{KQ}(-1)^{J}(2J+1)^{1/2}\left(\begin{array}{ccc}
J & J & K\\
0 & 0 & 0
\end{array}\right)\left\langle T(J)_{KQ}^{\dagger}\right\rangle Y_{KQ}(\theta,\phi)
\end{equation}

Where $W(\theta,\phi)$ is the spatial distribution function, and
$Y_{KQ}(\theta,\phi)$ are spherical harmonics.

+++

### Example: state selected, 1-photon, transition ##
For a basic state-selected transition, following absorption of a photon, 

\begin{equation}
|J_{i}\rangle\overset{1,q}{\rightarrow}|J_{f}\rangle
\end{equation}

The corresponding density matrix is proportional to the angular momentum coupling coefficient (see Sect. 7 in Blum [1]; also Sect. 3.1.1 and Eqn. 3.5 in Hockett [3], and Reid et. al. [4]):

\begin{equation}
\boldsymbol{\rho}^{(1)}(J_f)_{M',M}\propto\sum_{M_{g}}\left(\begin{array}{ccc}
J_{i} & 1 & J_{f}\\
-M_{i} & q & M_{f}
\end{array}\right)^{2}
\end{equation}

Where it has been assumed that the initial state $J_i$ is isotropic, and all $M_i$ are equally populated.

The properties of the final state $M$-level distribution will then depend on the transition ($\Delta J$) and the polarization of the light ($q$).

Note that in the Quantum Beats section the notation was such that $J_i \equiv J'$, and $J_f \equiv J$, and implicitly defined as $\langle T(J;t)_{KQ}^{\dagger} \rangle \equiv \langle T(J'=J\pm1,J;t)_{KQ}^{\dagger} \rangle$, as appropriate for a 1-photon transition.

Hence:

\begin{equation}
\left\langle T(J)_{KQ}^{\dagger}\right\rangle =\sum_{M'M}\boldsymbol{\rho}^{(1)}(J)_{M',M}\times(-1)^{J'-M'}(2K+1)^{1/2}\left(\begin{array}{ccc}
J' & J & K\\
M' & -M & -Q
\end{array}\right)
\end{equation}

**TODO: need to tidy/tighten up notation here. Also distinguish general case from 1-photon and Xe cases herein.**

+++

***
**References**

[1] Blum, K. (2012). Density Matrix Theory and Applications (3rd Editio, Vol. 64). Berlin, Heidelberg: Springer Berlin Heidelberg. https://doi.org/10.1007/978-3-642-20561-3

[2] Zare, R. N. (1988). Angular Momentum: Understanding spatial aspects in chemistry and physics. John Wiley & Sons.

[3] Hockett, P. (2018). Quantum Metrology with Photoelectrons, Volume 1 Foundations. IOP Publishing. https://doi.org/10.1088/978-1-6817-4684-5 (See also links at top of document.)

[4] Forbes, R., Makhija, V., Underwood, J. G., Stolow, A., Wilkinson, I., Hockett, P., & Lausten, R. (2018). Quantum-beat photoelectron-imaging spectroscopy of Xe in the VUV. Physical Review A, 97(6), 063417. https://doi.org/10.1103/PhysRevA.97.063417; also [arXiv 1803.01081](http://arxiv.org/abs/1803.01081); and [web version on authorea](https://www.authorea.com/users/71114/articles/188337-quantum-beat-photoelectron-imaging-spectroscopy-of-xe-in-the-vuv).

[5] Fano, U., & Macek, J. H. (1973). Impact Excitation and Polarization of the Emitted Light. Reviews of Modern Physics, 45(4), 553–573. https://doi.org/10.1103/RevModPhys.45.553

***

```{code-cell} ipython3
from qbanalysis.hyperfine import *
import numpy as np
from epsproc.sphCalc import setBLMs
```

## Xe dynamics & alignment

+++

Here two examples are given, following the [work in ref. [4]](https://www.authorea.com/users/71114/articles/188337-quantum-beat-photoelectron-imaging-spectroscopy-of-xe-in-the-vuv), in which hyperfine wavepackets were prepared in Xe via excitation around 133 nm. Distinct wavepackets are created in the $^{129}Xe$ and $^{131}Xe$ isotopes, which have $I_{129}=1/2$ and $I_{131}=3/2$ and different hyperfine level structures.

+++

Xe natural abundances ([wiki](https://en.wikipedia.org/wiki/Isotopes_of_xenon#List_of_isotopes)):

- 129Xe: 0.264006(82) 
- 131Xe: 0.212324(30)

States:

- $I_{129}$: $F=1/2,3/2$, $\Delta E=0.2863(5)$~cm$^{-1}$
- $I_{131}$: $F=1/2,3/2,5/2$, $\Delta E=0.0855(10),0.2276(29)$~cm$^{-1}$ respectively.

+++

\begin{table}
\begin{centering}
\begin{tabular}{|c|c|c|c|c||c|c|}
\hline 
Isotope & $F$, $F'$ & Splitting/cm$^{-1}$ & \multicolumn{2}{c||}{Hyperfine consts.} & \multicolumn{2}{c|}{Literature}\tabularnewline
\hline 
 &  &  & A/MHz & B/MHz & A/MHz & B/MHz\tabularnewline
\hline 
\hline 
129 ($I=1/2$) & 1/2, 3/2 & 0.2863 (5) & -5723 (9) & - & -5808 (2) {[}a{]}, -5806 (4) {[}b{]}, -5799 (9) {[}c{]} & - \tabularnewline
\hline 
131 ($I=3/2$) & 3/2, 1/2 & 0.0855 (10) & 1697 (30) & -8 (7) & 1709.3 (7) {[}a{]}, 1710 (6) {[}b{]}, 1716 (3) {[}c{]} & 30.3 (8) {[}a{]}, 16 (3) {[}b{]}, 24 (6) {[}c{]}\tabularnewline
\hline 
 & 5/2, 3/2 & 0.1411 (29) &  &  &  & \tabularnewline
\hline 
 & 5/2, 1/2 & 0.2276 (29) &  &  &  & \tabularnewline
\hline 
\end{tabular}
\par\end{centering}

\caption{{\label{tab:HFS}Measured level splittings and the hyperfine constants determined. Statistical uncertainty estimates are given for the measurements. Literature values reproduced from ref. (D'Amico 1999), table II, with {[}a{]} D'Amico et. al. , {[}b{]} Jackson \& Coulombe (Jackson 1975), {[}c{]} Fischer et. al. (Fischer 1974).} (Reproduced from [4]).}
\end{table}

```{code-cell} ipython3
# Use Pandas and local data
from qbanalysis.dataset import loadXeProps
XefilePath='../../scratch/Xe_data_table_fixedFractions.ods'
xeProps = loadXeProps(XefilePath)
```

```{code-cell} ipython3
xeProps.style.set_caption("Hello World")
```

```{figure} ../Level_Drawing_edit_310518.svg
---
name: Xe-levels-fig
---
Energy-level diagram for the prepared hyperfine states (lower section), and final ion states (upper section). The energies are not to scale. Values from NIST.
```

```{code-cell} ipython3
#*** Set list of states, see table 1 in ref. [4]
# Defined by JFlist=[J, I, F, EF]
# E values from cm-1 to J

Jconv = 1.6021773E-19/8065.54429

# Set states for Xe129 case
JF129 = np.array([[1, 0.5, 0.5, 0*Jconv],[1, 0.5, 1.5, 0.2863*Jconv]])  # Differences in cm-1

# Set states for Xe131 case
JF131 = np.array([[1, 1.5, 0.5, 0*Jconv],[1, 1.5, 1.5, 0.0855*Jconv],[1, 1.5, 2.5, 0.2276*Jconv]])  # Differences in cm-1

# Define intial & photon states
Ji = 0  # Initial |J>
p = (1,0)   # Coupling (photon) |1,q>

#*** Other settings

# Set t-axis, in ps
tIn = np.arange(0,1000,5)*1e-12

# Plot options
plotOpts = {'width':1000}
```

### $^{129}Xe$

```{code-cell} ipython3
:tags: [full-width]

# Calculate 1-photon abs. and hyperfine wavepacket evolution

# Set final state parameters by isotope
JFlist = JF129
Jf = int(JFlist[0][0]) # Final state J

# Calculate T(J)KQ following 1-photon abs.
TKQ = TKQpmm(Jf,Jf, Ji = Ji, p = p)
# print(TKQ)

# Calculate T(J;t)KQ
TJt = TJtKQ(JFlist,TKQ,tIn)

# Convert to Xarray & plot
basicXR129 = setBLMs(TJt.astype(float), t=tIn/1e-12, LMLabels=TKQ[:,0:2].astype(int), dimNames=['TKQ', 't'])

# Update some parameters for current case...
basicXR129 = basicXR129.unstack('TKQ').rename({'l':'K','m':'Q'}).stack({'TKQ':('K','Q')})
basicXR129.attrs['dataType']='TKQ'
basicXR129.attrs['long_name']='Irreducible tensor parameters'
basicXR129.name = '129Xe'
basicXR129.attrs['abundance'] = 0.264006  # (82)
basicXR129.attrs['states'] = {'JFlist':JFlist, 'Ji':Ji, 'Jf':Jf, 'p':p}

# Plot with hvplot/Holoviews/Bokeh
basicXR129.unstack().hvplot.line(x='t', **plotOpts).overlay(['K','Q'])
```

The dynamics show the expected, simple, quantum beat structure in
the $\langle T(J;t)_{KQ}^{\dagger}\rangle$. For 1-photon excitation,
with linearly polarised light, only $K=0,\,2,\,Q=0$ terms contribute.
The $(0,0)$ term reflects the total population, hence is temporally-invariant,
while the $(2,0)$ term shows the changing alignment as the wavepacket
evolves. 

The allowed terms, and phase of the quantum beats, depends on the transition - i.e. initial and final $J$ state, and photon angular momentum. For example, with circularly polarised light $M_p = +1$, terms with $K=1$ are also allowed, and are out-of-phase with $K=2$ terms.

+++

### $^{131}Xe$

```{code-cell} ipython3
:tags: [full-width]

# Calculate 1-photon abs. and hyperfine wavepacket evolution

# Set final state parameters by isotope
JFlist = JF131
Jf = int(JFlist[0][0]) # Final state J

# Calculate T(J)KQ following 1-photon abs.
TKQ = TKQpmm(Jf,Jf, Ji = Ji, p = p)

# print(TKQ)

# Calculate T(J;t)KQ
TJt = TJtKQ(JFlist,TKQ,tIn)

# Convert to Xarray & plot
from epsproc.sphCalc import setBLMs

basicXR131 = setBLMs(TJt.astype(float), t=tIn/1e-12, LMLabels=TKQ[:,0:2].astype(int), dimNames=['TKQ', 't'])

# Update some parameters for current case...
basicXR131 = basicXR131.unstack('TKQ').rename({'l':'K','m':'Q'}).stack({'TKQ':('K','Q')})
basicXR131.attrs['dataType']='TKQ'
basicXR131.attrs['long_name']='Irreducible tensor parameters'
basicXR131.name = '131Xe'
basicXR131.attrs['abundance'] = 0.212324  # (30)
basicXR131.attrs['states'] = {'JFlist':JFlist, 'Ji':Ji, 'Jf':Jf, 'p':p}

# Plot with hvplot/Holoviews/Bokeh
basicXR131.unstack().hvplot.line(x='t', **plotOpts).overlay(['K','Q'])
```

## Quick comparison with experimental data

The experimental data may directly resemble the underlying wavepacket in some cases, e.g. if the probe process is somewhat direct. A quick time-domain plot should reveal similarities, if any...

+++

### Read experimental data

```{code-cell} ipython3
# 

from epsproc import IO
from pathlib import Path

dataPath = Path('/tmp/xe_analysis')
dataTypes = ['BLMall', 'BLMerr', 'BLMerrCycle']   # Read these types, should just do dir scan here.

# # Read from HDF5/NetCDF files
# # TO FIX: this should be identical to loadFinalDataset(dataPath), but gives slightly different plots - possibly complex/real/abs confusion?
# dataDict = {}
# for item in dataTypes:
#     dataDict[item] = IO.readXarray(fileName=f'Xe_dataset_{item}.nc', filePath=dataPath.as_posix()).real
#     dataDict[item].name = item

# Read from raw data files
from qbanalysis.dataset import loadFinalDataset
dataDict = loadFinalDataset(dataPath)
```

```{code-cell} ipython3
:tags: [full-width]

from qbanalysis.plots import plotFinalDatasetBLMt
hvData = plotFinalDatasetBLMt(**dataDict)
hvData
```

## Plot experiment + model wavepacket

Here the model wavepacket is defined as an incoherent sum over the two isotope components:

$$
M(t) = 1/n \sum_{i} N_{i}\langle T(J,i;t)_{KQ}^{\dagger} \rangle
$$

Where $i$ labels the isotopes, and $N_{i}$ the natural abundance, and $n=\sum_{i}N_i$ is the normalisation constant.

```{code-cell} ipython3
:tags: [full-width]

# Overlay plots

#*** Set model results: sum 129Xe + 131Xe TKQ

# All dims
# hvData * (basicXR+basicXR129).unstack().hvplot.line(x='t').overlay(['K','Q'])

# With subselection
# hvData * (0.5*(basicXR131+basicXR129)).sel({'K':2}).unstack().hvplot.line(x='t').overlay(['Q'])

# Include abundances...

renorm = basicXR131.attrs['abundance'] + basicXR129.attrs['abundance']
isoSum = (basicXR131*basicXR131.attrs['abundance']+basicXR129*basicXR129.attrs['abundance'])/renorm

#*** Plot
# hvData * isoSum.sel({'K':2}).unstack().hvplot.line(x='t').overlay(['Q'])
modelPlot = isoSum.sel({'K':2}).unstack().hvplot.line(x='t', color='k', line_dash='dashed').overlay(['Q']) 

# (modelPlot * hvData).opts(width=1000)  # Can't set width here...?
# (modelPlot.opts(width=1000) * hvData.opts(width=1000))  # Ah, this works
(modelPlot.opts(**plotOpts) * hvData.opts(**plotOpts))  # Ah, this works
# modelPlot * hvData
```

+++ {"tags": ["remove-cell"]}

INTERESTING....

- L=4 case almost matches exactly... must be direct relation here (if only single partial wave...???). Do see a slight t-shift though, which might be a phase or just expt. shift... TBC...
- Should be sensitive to other stuff for L=2 case?
- Should be sensitive to natural abundances here.
- Safe to assume same matE for isotopes?

+++

## Compare states

```{code-cell} ipython3
basicXR131.unstack().hvplot.line(x='t', **plotOpts).overlay(['K','Q']) * basicXR129.unstack().hvplot.line(x='t', **plotOpts).overlay(['K','Q']) * modelPlot
```

```{code-cell} ipython3

```
